<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:TorrentFree.ViewModels"
             xmlns:models="clr-namespace:TorrentFree.Models"
             xmlns:converters="clr-namespace:TorrentFree.Converters"
             xmlns:controls="clr-namespace:TorrentFree.Controls"
             xmlns:xaml="clr-namespace:Microsoft.Maui.Controls.Xaml;assembly=Microsoft.Maui.Controls.Xaml"
             xmlns:maui="clr-namespace:Microsoft.Maui.Controls;assembly=Microsoft.Maui.Controls"
             x:Class="TorrentFree.MainPage"
             x:DataType="viewmodels:MainViewModel"
             BackgroundColor="{AppThemeBinding Light={StaticResource PageBackgroundColorLight}, Dark={StaticResource PageBackgroundColorDark}}"
             Title="Dashboard">

       <ContentPage.Resources>
              <ResourceDictionary>
                     <!-- Converters (defined locally to ensure availability) -->
                     <converters:InverseBoolConverter x:Key="InverseBoolConverter"/>
                     <converters:StringNotEmptyConverter x:Key="StringNotEmptyConverter"/>
                     <converters:ObjectNotNullConverter x:Key="ObjectNotNullConverter"/>
                     <converters:ProgressConverter x:Key="ProgressConverter"/>
                     <converters:StatusColorConverter x:Key="StatusColorConverter"/>
                     <converters:OddIndexConverter x:Key="OddIndexConverter"/>

                     <!-- Status Colors -->
                     <Color x:Key="StatusQueued">#FFA726</Color>
                     <Color x:Key="StatusDownloading">#42A5F5</Color>
                     <Color x:Key="StatusPaused">#BDBDBD</Color>
                     <Color x:Key="StatusCompleted">#66BB6A</Color>
                     <Color x:Key="StatusSeeding">#26A69A</Color>
                     <Color x:Key="StatusFailed">#EF5350</Color>
                     <Color x:Key="StatusStopped">#9E9E9E</Color>

                     <!-- Card Style -->
                     <Color x:Key="CardBackground">#FFFFFF</Color>
                     <Color x:Key="CardBackgroundDark">#1F1F23</Color>
                     <Color x:Key="CardBackgroundAlt">#E6ECFF</Color>
                     <Color x:Key="CardBackgroundAltDark">#2A2F3A</Color>
                     <Color x:Key="PageBackgroundColorLight">#F3F4F6</Color>
                     <Color x:Key="PageBackgroundColorDark">#111827</Color>
                     <Color x:Key="CardBorderColor">#E5E7EB</Color>
                     <Color x:Key="TextSecondaryLight">#6B7280</Color>
                     <Color x:Key="TextSecondaryDark">#CBD5E1</Color>
                     <Color x:Key="TextSecondary">#6B7280</Color>
                     <Color x:Key="AccentColor">#5B5BD6</Color>
                     <Color x:Key="AccentColorLight">#8B8CF1</Color>

                     <!-- Button Styles -->
                     <Style x:Key="ActionButton"
                            TargetType="Button">
                            <Setter Property="FontSize"
                                    Value="12"/>
                            <Setter Property="Padding"
                                    Value="10,6"/>
                            <Setter Property="CornerRadius"
                                    Value="10"/>
                            <Setter Property="HeightRequest"
                                    Value="36"/>
                            <Setter Property="MinimumWidthRequest"
                                    Value="70"/>
                     </Style>

                     <!-- Icon Button Style - square buttons with larger icons -->
                     <Style x:Key="IconButton"
                            TargetType="Button">
                            <Setter Property="FontSize"
                                    Value="16"/>
                            <Setter Property="Padding"
                                    Value="0"/>
                            <Setter Property="CornerRadius"
                                    Value="10"/>
                            <Setter Property="HeightRequest"
                                    Value="36"/>
                            <Setter Property="WidthRequest"
                                    Value="36"/>
                            <Setter Property="MinimumWidthRequest"
                                    Value="36"/>
                            <Setter Property="BackgroundColor"
                                    Value="#F3F4F6"/>
                            <Setter Property="TextColor"
                                    Value="#374151"/>
                            <Setter Property="BorderColor"
                                    Value="#E5E7EB"/>
                            <Setter Property="BorderWidth"
                                    Value="1"/>
                     </Style>

                     <Style x:Key="StartButton"
                            TargetType="Button"
                            BasedOn="{StaticResource IconButton}">
                            <Setter Property="BackgroundColor"
                                    Value="#ECFDF3"/>
                            <Setter Property="TextColor"
                                    Value="#16A34A"/>
                     </Style>

                     <Style x:Key="PauseButton"
                            TargetType="Button"
                            BasedOn="{StaticResource IconButton}">
                            <Setter Property="BackgroundColor"
                                    Value="#FFF7ED"/>
                            <Setter Property="TextColor"
                                    Value="#F97316"/>
                     </Style>

                     <Style x:Key="StopButton"
                            TargetType="Button"
                            BasedOn="{StaticResource IconButton}">
                            <Setter Property="BackgroundColor"
                                    Value="#FEF2F2"/>
                            <Setter Property="TextColor"
                                    Value="#DC2626"/>
                     </Style>

                     <Style x:Key="RemoveButton"
                            TargetType="Button"
                            BasedOn="{StaticResource IconButton}">
                            <Setter Property="BackgroundColor"
                                    Value="#FEF2F2"/>
                            <Setter Property="TextColor"
                                    Value="#DC2626"/>
                     </Style>

                     <Style x:Key="FolderButton"
                            TargetType="Button"
                            BasedOn="{StaticResource IconButton}">
                            <Setter Property="BackgroundColor"
                                    Value="#EFF6FF"/>
                            <Setter Property="TextColor"
                                    Value="#2563EB"/>
                     </Style>
              </ResourceDictionary>
       </ContentPage.Resources>

       <Grid RowDefinitions="Auto,Auto,*"
             Padding="16,12">

              <!-- Header Section -->
              <Grid Grid.Row="0"
                    ColumnDefinitions="*,Auto"
                    RowDefinitions="Auto"
                    ColumnSpacing="12">
                     <HorizontalStackLayout Grid.Row="0"
                                            Grid.Column="0"
                                            Spacing="10"
                                            VerticalOptions="Center">
                            <Image Source="app_logo.svg"
                                   WidthRequest="28"
                                   HeightRequest="28"/>
                            <VerticalStackLayout Spacing="2">
                                   <Label Text="Torrent Free · Hub"
                                          FontSize="24"
                                          FontAttributes="Bold"
                                          TextColor="{StaticResource AccentColor}"
                                          HorizontalOptions="Start"/>
                                   <Label Text="Fast and simple torrent downloads"
                                          FontSize="12"
                                          TextColor="{StaticResource TextSecondary}"
                                          HorizontalOptions="Start"/>
                            </VerticalStackLayout>
                     </HorizontalStackLayout>
                     <Button Grid.Row="0"
                             Grid.Column="1"
                             Text="⚙"
                             Style="{StaticResource IconButton}"
                             BackgroundColor="{StaticResource AccentColorLight}"
                             TextColor="White"
                             Command="{Binding OpenSettingsCommand}"/>
              </Grid>

              <!-- Input Section -->
              <VerticalStackLayout Grid.Row="1"
                                   Spacing="8"
                                   Margin="0,16,0,16">
                     <Border Padding="12"
                             Stroke="{StaticResource CardBorderColor}"
                             Background="{AppThemeBinding Light={StaticResource CardBackground}, Dark={StaticResource CardBackgroundDark}}">
                            <Border.StrokeShape>
                                   <RoundRectangle CornerRadius="12"/>
                            </Border.StrokeShape>
                            <Grid ColumnDefinitions="*,Auto"
                                  ColumnSpacing="12">
                                   <Entry Grid.Column="0"
                                          Placeholder="Enter magnet link here..."
                                          Text="{Binding MagnetLinkInput}"
                                          ReturnCommand="{Binding AddTorrentCommand}"
                                          FontSize="14"
                                          ClearButtonVisibility="WhileEditing"
                                          Keyboard="Url"
                                          MaxLength="4000"/>

                                   <Button Grid.Column="1"
                                           Text="Browse"
                                           Command="{Binding BrowseTorrentFileCommand}"
                                           BackgroundColor="{StaticResource AccentColor}"
                                           TextColor="White"
                                           FontSize="14"
                                           FontAttributes="Bold"
                                           CornerRadius="8"
                                           Padding="16,8"
                                           HeightRequest="44"/>
                            </Grid>
                     </Border>

                     <Label Text="{Binding ErrorMessage}"
                            TextColor="{StaticResource StatusFailed}"
                            IsVisible="{Binding ErrorMessage, Converter={StaticResource StringNotEmptyConverter}}"
                            FontSize="12"
                            HorizontalOptions="Center"/>

                     <Border Padding="12"
                             Stroke="{StaticResource CardBorderColor}"
                             Background="{AppThemeBinding Light={StaticResource CardBackground}, Dark={StaticResource CardBackgroundDark}}">
                            <Border.StrokeShape>
                                   <RoundRectangle CornerRadius="12"/>
                            </Border.StrokeShape>
                            <VerticalStackLayout Spacing="8">
                                   <Label Text="Bandwidth"
                                          FontSize="13"
                                          FontAttributes="Bold"/>
                                   <Grid ColumnDefinitions="*,*"
                                         ColumnSpacing="12">
                                          <VerticalStackLayout Grid.Column="0"
                                                               Spacing="4">
                                                 <Label Text="Download KB/s"
                                                        FontSize="10"
                                                        TextColor="{AppThemeBinding Light={StaticResource TextSecondaryLight}, Dark={StaticResource TextSecondaryDark}}"/>
                                                 <controls:LineChartView Values="{Binding GlobalDownloadHistory}"
                                                                         LineColor="#42A5F5"
                                                                         FillColor="#2642A5F5"
                                                                         HeightRequest="48"/>
                                          </VerticalStackLayout>
                                          <VerticalStackLayout Grid.Column="1"
                                                               Spacing="4">
                                                 <Label Text="Upload KB/s"
                                                        FontSize="10"
                                                        TextColor="{AppThemeBinding Light={StaticResource TextSecondaryLight}, Dark={StaticResource TextSecondaryDark}}"/>
                                                 <controls:LineChartView Values="{Binding GlobalUploadHistory}"
                                                                         LineColor="#26A69A"
                                                                         FillColor="#2626A69A"
                                                                         HeightRequest="48"/>
                                          </VerticalStackLayout>
                                   </Grid>
                            </VerticalStackLayout>
                     </Border>
              </VerticalStackLayout>

              <!-- Downloads Section -->
              <Grid Grid.Row="2"
                    RowDefinitions="Auto,Auto,*">
                     <Grid Grid.Row="0"
                           ColumnDefinitions="*,Auto,Auto"
                           ColumnSpacing="12"
                           Margin="0,0,0,12">
                            <Label Grid.Column="0"
                                   Text="Downloads"
                                   FontSize="18"
                                   FontAttributes="Bold"/>
                            <HorizontalStackLayout Grid.Column="1"
                                                   Spacing="6"
                                                   VerticalOptions="Center">
                                   <CheckBox IsChecked="{Binding SortByStatus}"/>
                                   <Label Text="Downloading on top"
                                          FontSize="12"
                                          TextColor="{StaticResource TextSecondary}"
                                          VerticalOptions="Center"/>
                            </HorizontalStackLayout>
                            <Button Grid.Column="2"
                                    Text="Details"
                                    Style="{StaticResource ActionButton}"
                                    BackgroundColor="#EEF2FF"
                                    TextColor="#4F46E5"
                                    Command="{Binding ToggleSelectedTorrentDetailsCommand}"
                                    IsEnabled="{Binding SelectedTorrent, Converter={StaticResource ObjectNotNullConverter}}"/>
                     </Grid>

                     <Border Grid.Row="1"
                             Padding="12"
                             Stroke="{StaticResource CardBorderColor}"
                             Background="{AppThemeBinding Light={StaticResource CardBackground}, Dark={StaticResource CardBackgroundDark}}"
                             IsVisible="{Binding CanShowSelectedTorrentDetails}">
                            <Border.StrokeShape>
                                   <RoundRectangle CornerRadius="12"/>
                            </Border.StrokeShape>
                            <Grid RowDefinitions="Auto,Auto,Auto"
                                  ColumnDefinitions="*,*"
                                  ColumnSpacing="12"
                                  RowSpacing="8">
                                   <Label Grid.Row="0"
                                          Grid.ColumnSpan="2"
                                          Text="Selected torrent limits"
                                          FontSize="13"
                                          FontAttributes="Bold"/>

                                   <VerticalStackLayout Grid.Row="1"
                                                        Grid.Column="0"
                                                        Spacing="4">
                                          <Label Text="Download KB/s"
                                                 FontSize="10"
                                                 TextColor="{AppThemeBinding Light={StaticResource TextSecondaryLight}, Dark={StaticResource TextSecondaryDark}}"/>
                                          <Entry Text="{Binding SelectedTorrent.DownloadLimitKbps}"
                                                 Keyboard="Numeric"
                                                 Placeholder="0 = global"/>
                                   </VerticalStackLayout>

                                   <VerticalStackLayout Grid.Row="1"
                                                        Grid.Column="1"
                                                        Spacing="4">
                                          <Label Text="Upload KB/s"
                                                 FontSize="10"
                                                 TextColor="{AppThemeBinding Light={StaticResource TextSecondaryLight}, Dark={StaticResource TextSecondaryDark}}"/>
                                          <Entry Text="{Binding SelectedTorrent.UploadLimitKbps}"
                                                 Keyboard="Numeric"
                                                 Placeholder="0 = global"/>
                                   </VerticalStackLayout>

                                   <VerticalStackLayout Grid.Row="2"
                                                        Grid.Column="0"
                                                        Spacing="4">
                                          <Label Text="Max seed ratio"
                                                 FontSize="10"
                                                 TextColor="{AppThemeBinding Light={StaticResource TextSecondaryLight}, Dark={StaticResource TextSecondaryDark}}"/>
                                          <Entry Text="{Binding SelectedTorrent.MaxSeedRatio}"
                                                 Keyboard="Numeric"
                                                 Placeholder="0 = global"/>
                                   </VerticalStackLayout>

                                   <VerticalStackLayout Grid.Row="2"
                                                        Grid.Column="1"
                                                        Spacing="4">
                                          <Label Text="Max seed minutes"
                                                 FontSize="10"
                                                 TextColor="{AppThemeBinding Light={StaticResource TextSecondaryLight}, Dark={StaticResource TextSecondaryDark}}"/>
                                          <Entry Text="{Binding SelectedTorrent.MaxSeedMinutes}"
                                                 Keyboard="Numeric"
                                                 Placeholder="0 = global"/>
                                   </VerticalStackLayout>
                            </Grid>
                     </Border>

                     <!-- Empty State -->
                     <VerticalStackLayout Grid.Row="2"
                                          IsVisible="{Binding IsEmpty}"
                                          VerticalOptions="Center"
                                          HorizontalOptions="Center"
                                          Spacing="16">
                            <Label Text="No downloads yet"
                                   FontSize="18"
                                   FontAttributes="Bold"
                                   HorizontalOptions="Center"/>
                            <Label Text="Add a magnet link to get started."
                                   FontSize="14"
                                   TextColor="{StaticResource TextSecondary}"
                                   HorizontalOptions="Center"/>
                     </VerticalStackLayout>

                     <!-- Downloads List -->
                     <CollectionView Grid.Row="2"
                                     ItemsSource="{Binding DisplayTorrents}"
                                     SelectionMode="Single"
                                     SelectedItem="{Binding SelectedTorrent}"
                                     IsVisible="{Binding IsEmpty, Converter={StaticResource InverseBoolConverter}}">
                            <CollectionView.ItemTemplate>
                                   <DataTemplate x:DataType="models:TorrentItem">
                                          <Border Margin="0,0,0,12"
                                                  Padding="12"
                                                  Stroke="{StaticResource CardBorderColor}"
                                                  Background="{AppThemeBinding Light={StaticResource CardBackground}, Dark={StaticResource CardBackgroundDark}}">
                                                 <Border.StrokeShape>
                                                        <RoundRectangle CornerRadius="12"/>
                                                 </Border.StrokeShape>
                                                 <Border.Triggers>
                                                        <DataTrigger TargetType="Border"
                                                                     Binding="{Binding DisplayIndex, Converter={StaticResource OddIndexConverter}}"
                                                                     Value="True">
                                                               <Setter Property="Background"
                                                                       Value="{AppThemeBinding Light={StaticResource CardBackgroundAlt}, Dark={StaticResource CardBackgroundAltDark}}"/>
                                                        </DataTrigger>
                                                 </Border.Triggers>
                                                 <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto"
                                                       RowSpacing="8">

                                                        <!-- Row 0: Name and Status -->
                                                        <Grid Grid.Row="0"
                                                              ColumnDefinitions="*,Auto,Auto"
                                                              ColumnSpacing="8">
                                                               <VerticalStackLayout Grid.Column="0"
                                                                                    Spacing="2">
                                                                      <Label Text="{Binding Name}"
                                                                             FontSize="15"
                                                                             FontAttributes="Bold"
                                                                             LineBreakMode="TailTruncation"
                                                                             MaxLines="2"/>
                                                                      <Label Text="{Binding ErrorMessage}"
                                                                             FontSize="11"
                                                                             TextColor="{StaticResource StatusFailed}"
                                                                             IsVisible="{Binding ErrorMessage, Converter={StaticResource StringNotEmptyConverter}}"
                                                                             LineBreakMode="TailTruncation"
                                                                             MaxLines="2"/>
                                                                      <Label Text="{Binding StatusHint}"
                                                                             FontSize="11"
                                                                             TextColor="{StaticResource TextSecondary}"
                                                                             IsVisible="{Binding StatusHint, Converter={StaticResource StringNotEmptyConverter}}"
                                                                             LineBreakMode="TailTruncation"
                                                                             MaxLines="2"/>
                                                               </VerticalStackLayout>
                                                               <Button Grid.Column="1"
                                                                       Text="📂"
                                                                       Style="{StaticResource FolderButton}"
                                                                       Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:MainViewModel}}, Path=ShowInFolderCommand}"
                                                                       CommandParameter="{Binding .}"
                                                                       IsEnabled="{Binding CanOpenDownloadedFile}"
                                                                       Opacity="0.5">
                                                                      <Button.Triggers>
                                                                             <DataTrigger TargetType="Button"
                                                                                          Binding="{Binding CanOpenDownloadedFile}"
                                                                                          Value="True">
                                                                                    <Setter Property="Opacity"
                                                                                            Value="1"/>
                                                                             </DataTrigger>
                                                                      </Button.Triggers>
                                                               </Button>
                                                               <Border Grid.Column="2"
                                                                       Padding="8,4"
                                                                       Stroke="Transparent"
                                                                       Background="{Binding Status, Converter={StaticResource StatusColorConverter}}">
                                                                      <Border.StrokeShape>
                                                                             <RoundRectangle CornerRadius="12"/>
                                                                      </Border.StrokeShape>
                                                                      <Label Text="{Binding StatusText}"
                                                                             FontSize="11"
                                                                             TextColor="White"
                                                                             FontAttributes="Bold"/>
                                                               </Border>
                                                        </Grid>

                                                        <!-- Row 1: Progress Bar -->
                                                        <Grid Grid.Row="1"
                                                              ColumnDefinitions="*,Auto"
                                                              ColumnSpacing="8">
                                                               <ProgressBar Grid.Column="0"
                                                                            Progress="{Binding Progress, Converter={StaticResource ProgressConverter}}"
                                                                            ProgressColor="{StaticResource AccentColor}"
                                                                            HeightRequest="6"/>
                                                               <Label Grid.Column="1"
                                                                      Text="{Binding Progress, StringFormat='{0:F0}%'}"
                                                                      FontSize="10"
                                                                      TextColor="{StaticResource TextSecondary}"
                                                                      VerticalOptions="Center"/>
                                                        </Grid>

                                                        <!-- Row 2: Stats -->
                                                        <Grid Grid.Row="2"
                                                              ColumnDefinitions="*,*,*,*,*,*"
                                                              ColumnSpacing="8">
                                                               <VerticalStackLayout Grid.Column="0"
                                                                                    Spacing="2">
                                                                      <Label Text="Size"
                                                                             FontSize="10"
                                                                             TextColor="Gray"/>
                                                                      <Label Text="{Binding FormattedTotalSize}"
                                                                             FontSize="12"
                                                                             FontAttributes="Bold"/>
                                                               </VerticalStackLayout>
                                                               <VerticalStackLayout Grid.Column="1"
                                                                                    Spacing="2">
                                                                      <Label Text="Down"
                                                                             FontSize="10"
                                                                             TextColor="{AppThemeBinding Light={StaticResource TextSecondaryLight}, Dark={StaticResource TextSecondaryDark}}"/>
                                                                      <Label Text="{Binding FormattedDownloadSpeed}"
                                                                             FontSize="12"
                                                                             FontAttributes="Bold"/>
                                                               </VerticalStackLayout>
                                                               <VerticalStackLayout Grid.Column="2"
                                                                                    Spacing="2">
                                                                      <Label Text="Up"
                                                                             FontSize="10"
                                                                             TextColor="{AppThemeBinding Light={StaticResource TextSecondaryLight}, Dark={StaticResource TextSecondaryDark}}"/>
                                                                      <Label Text="{Binding FormattedUploadSpeed}"
                                                                             FontSize="12"
                                                                             FontAttributes="Bold"/>
                                                               </VerticalStackLayout>
                                                               <VerticalStackLayout Grid.Column="3"
                                                                                    Spacing="2">
                                                                      <Label Text="Seeds"
                                                                             FontSize="10"
                                                                             TextColor="{AppThemeBinding Light={StaticResource TextSecondaryLight}, Dark={StaticResource TextSecondaryDark}}"/>
                                                                      <Label Text="{Binding Seeders}"
                                                                             FontSize="12"
                                                                             FontAttributes="Bold"/>
                                                               </VerticalStackLayout>
                                                               <VerticalStackLayout Grid.Column="4"
                                                                                    Spacing="2">
                                                                      <Label Text="Peers"
                                                                             FontSize="10"
                                                                             TextColor="{AppThemeBinding Light={StaticResource TextSecondaryLight}, Dark={StaticResource TextSecondaryDark}}"/>
                                                                      <Label Text="{Binding Leechers}"
                                                                             FontSize="12"
                                                                             FontAttributes="Bold"/>
                                                               </VerticalStackLayout>
                                                               <VerticalStackLayout Grid.Column="5"
                                                                                    Spacing="2">
                                                                      <Label Text="ETA"
                                                                             FontSize="10"
                                                                             TextColor="{AppThemeBinding Light={StaticResource TextSecondaryLight}, Dark={StaticResource TextSecondaryDark}}"/>
                                                                      <Label Text="{Binding FormattedEstimatedTime}"
                                                                             FontSize="12"
                                                                             FontAttributes="Bold"/>
                                                               </VerticalStackLayout>
                                                        </Grid>

                                                        <!-- Row 3: Health & Availability -->
                                                        <Grid Grid.Row="3"
                                                              ColumnDefinitions="*,*"
                                                              ColumnSpacing="12">
                                                               <VerticalStackLayout Grid.Column="0"
                                                                                    Spacing="4">
                                                                      <Grid ColumnDefinitions="*,Auto">
                                                                             <Label Grid.Column="0"
                                                                                    Text="Health"
                                                                                    FontSize="10"
                                                                                    TextColor="{AppThemeBinding Light={StaticResource TextSecondaryLight}, Dark={StaticResource TextSecondaryDark}}"/>
                                                                             <Label Grid.Column="1"
                                                                                    Text="{Binding HealthScore}"
                                                                                    FontSize="10"
                                                                                    FontAttributes="Bold"/>
                                                                      </Grid>
                                                                      <ProgressBar Progress="{Binding HealthScore, Converter={StaticResource ProgressConverter}}"
                                                                                   ProgressColor="#FF7043"
                                                                                   HeightRequest="6"/>
                                                               </VerticalStackLayout>
                                                               <VerticalStackLayout Grid.Column="1"
                                                                                    Spacing="4">
                                                                      <Grid ColumnDefinitions="*,Auto">
                                                                             <Label Grid.Column="0"
                                                                                    Text="Availability"
                                                                                    FontSize="10"
                                                                                    TextColor="{StaticResource TextSecondary}"/>
                                                                             <Label Grid.Column="1"
                                                                                    Text="{Binding AvailabilityLabel}"
                                                                                    FontSize="10"
                                                                                    FontAttributes="Bold"/>
                                                                      </Grid>
                                                                      <ProgressBar Progress="{Binding AvailabilityPercent, Converter={StaticResource ProgressConverter}}"
                                                                                   ProgressColor="#7E57C2"
                                                                                   HeightRequest="6"/>
                                                               </VerticalStackLayout>
                                                        </Grid>

                                                        <!-- Row 4: Bandwidth Charts -->
                                                        <Grid Grid.Row="4"
                                                              ColumnDefinitions="*,*"
                                                              ColumnSpacing="12">
                                                               <VerticalStackLayout Grid.Column="0"
                                                                                    Spacing="4">
                                                                      <Label Text="Download KB/s"
                                                                             FontSize="10"
                                                                             TextColor="{StaticResource TextSecondary}"/>
                                                                      <controls:LineChartView Values="{Binding DownloadSpeedHistory}"
                                                                                              LineColor="#42A5F5"
                                                                                              FillColor="#2642A5F5"
                                                                                              HeightRequest="40"/>
                                                               </VerticalStackLayout>
                                                               <VerticalStackLayout Grid.Column="1"
                                                                                    Spacing="4">
                                                                      <Label Text="Upload KB/s"
                                                                             FontSize="10"
                                                                             TextColor="{StaticResource TextSecondary}"/>
                                                                      <controls:LineChartView Values="{Binding UploadSpeedHistory}"
                                                                                              LineColor="#26A69A"
                                                                                              FillColor="#2626A69A"
                                                                                              HeightRequest="40"/>
                                                               </VerticalStackLayout>
                                                        </Grid>

                                                        <!-- Row 5: Action Buttons -->
                                                        <HorizontalStackLayout Grid.Row="5"
                                                                               Spacing="8"
                                                                               HorizontalOptions="End"
                                                                               Margin="0,8,0,0">
                                                               <Button Text="▶️"
                                                                       Style="{StaticResource StartButton}"
                                                                       Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:MainViewModel}}, Path=StartSpecificTorrentCommand}"
                                                                       CommandParameter="{Binding .}"
                                                                       IsVisible="{Binding CanStart}"/>
                                                               <Button Text="⏸️"
                                                                       Style="{StaticResource PauseButton}"
                                                                       Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:MainViewModel}}, Path=PauseSpecificTorrentCommand}"
                                                                       CommandParameter="{Binding .}"
                                                                       IsVisible="{Binding CanPause}"/>
                                                               <Button Text="⏹️"
                                                                       Style="{StaticResource StopButton}"
                                                                       Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:MainViewModel}}, Path=StopSpecificTorrentCommand}"
                                                                       CommandParameter="{Binding .}"
                                                                       IsVisible="{Binding CanStop}"/>
                                                               <Button Text="🗑️"
                                                                       Style="{StaticResource RemoveButton}"
                                                                       Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:MainViewModel}}, Path=RemoveSpecificTorrentCommand}"
                                                                       CommandParameter="{Binding .}"/>
                                                        </HorizontalStackLayout>
                                                 </Grid>
                                          </Border>
                                   </DataTemplate>
                            </CollectionView.ItemTemplate>
                     </CollectionView>
              </Grid>

              <!-- Loading Indicator -->
              <ActivityIndicator Grid.RowSpan="3"
                                 IsRunning="{Binding IsBusy}"
                                 IsVisible="{Binding IsBusy}"
                                 Color="{StaticResource AccentColor}"
                                 VerticalOptions="Center"
                                 HorizontalOptions="Center"/>
       </Grid>

</ContentPage>
